<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fresh-24 Financial Simulator</title>
    <link rel="stylesheet" href="/static/style.css">
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var icons = document.querySelectorAll('.sidebar-icon');
        var optionsSidebarContent = document.getElementById('options-sidebar-content');
        var userMenu = document.getElementById('user-menu');
        icons.forEach(function(icon) {
            icon.addEventListener('click', function(e) {
                e.preventDefault();
                var label = icon.getAttribute('data-label');
                optionsSidebarContent.textContent = label + ' Options';
                if (label === 'User') {
                    userMenu.style.display = 'block';
                } else {
                    userMenu.style.display = 'none';
                }
            });
        });
        // Hide user menu by default
        userMenu.style.display = 'none';
    });
    </script>
</head>
<body>
    <nav class="navbar">
        <span class="navbar-title">Fresh-24 Financial Simulator</span>
        <div class="navbar-links">
            <a href="/">Home</a>
            <a href="/login/">Login</a>
        </div>
    </nav>
    <div class="layout">
        <aside class="sidebar">
            <a href="#" class="sidebar-icon" data-label="Administrator">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#f7c97e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="8" r="4"/>
                    <path d="M4 20c0-4 8-4 8-4s8 0 8 4"/>
                    <rect x="9" y="16" width="6" height="4" rx="1" fill="#f7c97e" stroke="#f7c97e"/>
                </svg>
                <span class="tooltip">Administrator</span>
            </a>
            <a href="#" class="sidebar-icon" data-label="User">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#7ec3f7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 8-4 8-4s8 0 8 4"/></svg>
                <span class="tooltip">User</span>
            </a>
            <a href="#" class="sidebar-icon" data-label="Shipment">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#7ec3f7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="7" width="18" height="13" rx="2"/><path d="M16 3v4M8 3v4"/><path d="M3 10h18"/></svg>
                <span class="tooltip">Shipment</span>
            </a>
            <a href="#" class="sidebar-icon" data-label="Scheduling">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#7ec3f7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4"/><path d="M3 10h18"/></svg>
                <span class="tooltip">Scheduling</span>
            </a>
            <a href="#" class="sidebar-icon" data-label="Simulation">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#7ec3f7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                <span class="tooltip">Simulation</span>
            </a>
            <a href="#" class="sidebar-icon" data-label="Settings">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#7ec3f7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h.09a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51h.09a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                <span class="tooltip">Settings</span>
            </a>
        </aside>
        <aside id="options-sidebar" class="options-sidebar">
            <div id="options-sidebar-content">Select an option</div>
                <div id="user-menu" style="display:none">
                    <div class="vscode-tree">
                        <div class="vscode-tree-item" data-toggle="manage-branch">
                            <span class="vscode-tree-arrow">&gt;</span> Manage Branch
                        </div>
                        <div class="vscode-tree-children" data-parent="manage-branch" style="display:none;">
                            <div><a href="#" class="user-option menu-option">Add Branch</a></div>
                            <div><a href="#" class="user-option menu-option">Edit Branch</a></div>
                        </div>
                        <div class="vscode-tree-item" data-toggle="manage-products">
                            <span class="vscode-tree-arrow">&gt;</span> Manage Products
                        </div>
                        <div class="vscode-tree-children" data-parent="manage-products" style="display:none;">
                            <div><a href="#" class="user-option menu-option">Add Products</a></div>
                            <div><a href="#" class="user-option menu-option">View Products</a></div>
                        </div>
                    </div>
                </div>
                <div id="admin-menu" style="display:none">
                    <div class="vscode-tree">
                        <div class="vscode-tree-item" data-toggle="logistics">
                            <span class="vscode-tree-arrow">&gt;</span> Logistics
                        </div>
                        <div class="vscode-tree-children" data-parent="logistics" style="display:none;">
                            <div class="vscode-tree-item" data-toggle="air">
                                <span class="vscode-tree-arrow">&gt;</span> Air
                            </div>
                            <div class="vscode-tree-children" data-parent="air" style="display:none;">
                                <div><a href="#" class="admin-option menu-option">Mode</a></div>
                                <div><a href="#" class="admin-option menu-option">Airports</a></div>
                                <div><a href="#" class="admin-option menu-option">Aircraft</a></div>
                            </div>
                            <div class="vscode-tree-item">Land</div>
                            <div class="vscode-tree-item">Sea</div>
                        </div>
                        <div class="vscode-tree-item" data-toggle="user-management">
                            <span class="vscode-tree-arrow">&gt;</span> User Management
                        </div>
                        <div class="vscode-tree-children" data-parent="user-management" style="display:none;">
                            <div><a href="#" class="admin-option menu-option">User Management</a></div>
                        </div>
                        <div class="vscode-tree-item" data-toggle="supplychain">
                            <span class="vscode-tree-arrow">&gt;</span> Supply Chain
                        </div>
                        <div class="vscode-tree-children" data-parent="supplychain" style="display:none;"></div>
                    </div>
                </div>
        </aside>
        <main class="main-content">
            <div id="tab-bar" class="tab-bar"></div>
            <div id="tab-content">
                <h1>Welcome to the Financial Simulator</h1>
                <p>This is your home page. The UI uses a dark, cold color palette inspired by VS Code.</p>
            </div>
        </main>
        </aside>
        <!-- Side menu removed for minimal layout -->
        <!-- main-content now inside <main> above -->
    </div>
    <!-- Hidden template with the Add Aircraft form markup -->
    <template id="add-aircraft-fragment">
        {% include 'add_aircraft.html' %}
    </template>
    <!-- Hidden template with the Add Airport form markup -->
    <template id="add-airport-fragment">
        {% include 'add_airport.html' %}
    </template>
    <footer class="footer">
            <style>
            .vscode-tree-item.open > .vscode-tree-arrow {
                transform: rotate(90deg) scaleY(1.2);
                display: inline-block;
                transition: transform 0.1s;
            }
            /* Indent VS Code-style tree items and options (default for all menus) */
            .vscode-tree-children {
                padding-left: 2ch; /* keep groups a bit indented */
            }
            .menu-option {
                padding-left: 1ch; /* leaf options ~1 character indent */
                font-size: 0.9rem;  /* slightly smaller font for final options */
                color: var(--vscode-fg, #d4d4d4) !important; /* keep same high-contrast color */
                text-decoration: none;
                display: block;
            }
            /* Remove bullets and extra padding from user menu lists */
            #user-menu ul {
                list-style: none;
                margin: 0;
                padding-left: 0;
            }
            </style>
        <div>Powered by Dnamic aircraft Services</div>
        <div><a href="https://www.dnamic-tech.com" target="_blank" rel="noopener">www.dnamic-tech.com</a></div>
    <script>
    document.addEventListener('DOMContentLoaded', function() {
        var icons = document.querySelectorAll('.sidebar-icon');
        var optionsSidebarContent = document.getElementById('options-sidebar-content');
        var userMenu = document.getElementById('user-menu');
        var tabBar = document.getElementById('tab-bar');
        var tabContent = document.getElementById('tab-content');
        // Workspaces: each icon label gets its own workspace (tabs and activeTab)
        var workspaces = {};
        var currentWorkspace = null;

        // VS Code-style tree toggles (used by all menus with .vscode-tree)
        var treeToggleItems = document.querySelectorAll('.vscode-tree-item[data-toggle]');
        treeToggleItems.forEach(function(item) {
            item.addEventListener('click', function(e) {
                e.stopPropagation();
                var key = item.getAttribute('data-toggle');
                var children = document.querySelector('.vscode-tree-children[data-parent="' + key + '"]');
                if (children) {
                    var isOpen = children.style.display !== 'none';
                    children.style.display = isOpen ? 'none' : 'block';
                    item.classList.toggle('open', !isOpen);
                }
            });
        });

        icons.forEach(function(icon) {
            icon.addEventListener('click', function(e) {
                e.preventDefault();
                var label = icon.getAttribute('data-label');
                optionsSidebarContent.textContent = label + ' Options';
                userMenu.style.display = 'none';
                document.getElementById('admin-menu').style.display = 'none';
                if (label === 'User') {
                    userMenu.style.display = 'block';
                } else if (label === 'Administrator') {
                    document.getElementById('admin-menu').style.display = 'block';
                }
                // Switch workspace
                switchWorkspace(label);
            });
        });
        // Hide user menu by default
        userMenu.style.display = 'none';

        // Helper to create a tab in the current workspace
        function createTab(tabName, options) {
            if (!currentWorkspace) return null;
            var ws = workspaces[currentWorkspace];
            if (ws.openTabs[tabName]) {
                return ws.openTabs[tabName];
            }

            var tab = document.createElement('div');
            tab.className = 'tab';
            tab.dataset.tab = tabName;

            // Tab label
            var labelSpan = document.createElement('span');
            labelSpan.textContent = tabName;
            labelSpan.style.marginRight = '8px';
            labelSpan.addEventListener('click', function(e) {
                e.stopPropagation();
                setActiveTab(tabName);
            });
            tab.appendChild(labelSpan);

            var nonClosable = options && options.nonClosable;
            if (!nonClosable) {
                // Close button for regular tabs
                var closeBtn = document.createElement('button');
                closeBtn.className = 'tab-close-btn';
                closeBtn.textContent = 'Ã—';
                closeBtn.title = 'Close tab';
                closeBtn.style.background = 'transparent';
                closeBtn.style.border = 'none';
                closeBtn.style.color = '#d4d4d4';
                closeBtn.style.cursor = 'pointer';
                closeBtn.style.fontSize = '1rem';
                closeBtn.style.marginLeft = '2px';
                closeBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    // Remove tab from DOM and openTabs
                    tabBar.removeChild(tab);
                    delete ws.openTabs[tabName];
                    // If closed tab was active, activate another tab
                    if (ws.activeTab === tabName) {
                        var tabKeys = Object.keys(ws.openTabs);
                        if (tabKeys.length > 0) {
                            setActiveTab(tabKeys[tabKeys.length - 1]);
                        } else {
                            ws.activeTab = null;
                            tabContent.innerHTML = '<h1>Welcome to the Financial Simulator</h1><p>This is your home page. The UI uses a dark, cold color palette inspired by VS Code.</p>';
                        }
                    }
                });
                tab.appendChild(closeBtn);
            }

            tab.addEventListener('click', function() {
                setActiveTab(tabName);
            });

            tabBar.appendChild(tab);
            ws.openTabs[tabName] = tab;
            return tab;
        }

        // Tab logic (per workspace) for all menu options
        document.querySelectorAll('.menu-option').forEach(function(option) {
            option.addEventListener('click', function(e) {
                e.preventDefault();
                var tabName = option.textContent.trim();
                if (!currentWorkspace) return;
                createTab(tabName, { nonClosable: false });
                setActiveTab(tabName);
            });
        });

        function setActiveTab(tabName) {
            if (!currentWorkspace) return;
            var ws = workspaces[currentWorkspace];
            // Remove active from all tabs
            Object.values(ws.openTabs).forEach(function(tab) {
                tab.classList.remove('active');
            });
            // Set active
            if (ws.openTabs[tabName]) {
                ws.openTabs[tabName].classList.add('active');
                ws.activeTab = tabName;
                // Show content for the tab
                if (tabName === 'Aircraft') {
                    tabContent.innerHTML = '' +
                        '<div class="tab-content-inner aircraft-tab">' +
                            '<h2>Aircraft</h2>' +
                            '<section class="aircraft-list-section">' +
                                '<h3>Available Aircraft</h3>' +
                                '<div class="aircraft-list-placeholder">No aircraft loaded yet.</div>' +
                            '</section>' +
                            '<section class="aircraft-actions">' +
                                '<button id="add-aircraft-btn" class="primary-button">Add New Aircraft</button>' +
                            '</section>' +
                        '</div>';
                    var addBtn = document.getElementById('add-aircraft-btn');
                    if (addBtn) {
                        addBtn.addEventListener('click', function() {
                            if (!currentWorkspace) return;
                            createTab('Add Aircraft', { nonClosable: false });
                            setActiveTab('Add Aircraft');
                        });
                    }
                } else if (tabName === 'Add Aircraft') {
                    // Fetch the rendered form from the backend
                    fetch('/add-aircraft/')
                        .then(function(response) { return response.text(); })
                        .then(function(html) {
                            var parser = new DOMParser();
                            var doc = parser.parseFromString(html, 'text/html');
                            var form = doc.querySelector('.tab-content-inner');
                            if (form) {
                                tabContent.innerHTML = form.outerHTML;
                                // Execute inline scripts manually (innerHTML doesn't execute them)
                                var scripts = doc.querySelectorAll('script');
                                scripts.forEach(function(oldScript) {
                                    var newScript = document.createElement('script');
                                    if (oldScript.src) {
                                        newScript.src = oldScript.src;
                                    } else {
                                        newScript.textContent = oldScript.textContent;
                                    }
                                    document.body.appendChild(newScript);
                                });
                            } else {
                                // Fallback: show the full HTML response so errors are visible
                                tabContent.innerHTML = html;
                            }
                        })
                        .catch(function() {
                            tabContent.innerHTML = '<div class="tab-content-inner"><h2>Add Aircraft</h2><p>Form could not be loaded.</p></div>';
                        });
                } else if (tabName === 'Airports') {
                    tabContent.innerHTML = '' +
                        '<div class="tab-content-inner airports-tab">' +
                            '<h2>Airports</h2>' +
                            '<section class="airports-list-section">' +
                                '<h3>Available Airports</h3>' +
                                '<div class="airports-list-placeholder">No airports loaded yet.</div>' +
                            '</section>' +
                            '<section class="airports-actions">' +
                                '<button id="add-airport-btn" class="primary-button">Add New Airport</button>' +
                            '</section>' +
                        '</div>';
                    var addBtn = document.getElementById('add-airport-btn');
                    if (addBtn) {
                        addBtn.addEventListener('click', function() {
                            if (!currentWorkspace) return;
                            createTab('Add Airport', { nonClosable: false });
                            setActiveTab('Add Airport');
                        });
                    }
                } else if (tabName === 'Add Airport') {
                    // Fetch the rendered form from the backend
                    fetch('/add-airport/')
                        .then(function(response) { return response.text(); })
                        .then(function(html) {
                            var parser = new DOMParser();
                            var doc = parser.parseFromString(html, 'text/html');
                            var form = doc.querySelector('.tab-content-inner');
                            if (form) {
                                tabContent.innerHTML = form.outerHTML;
                                // Execute inline scripts manually (innerHTML doesn't execute them)
                                var scripts = doc.querySelectorAll('script');
                                scripts.forEach(function(oldScript) {
                                    var newScript = document.createElement('script');
                                    if (oldScript.src) {
                                        newScript.src = oldScript.src;
                                    } else {
                                        newScript.textContent = oldScript.textContent;
                                    }
                                    document.body.appendChild(newScript);
                                });
                            } else {
                                // Fallback: show the full HTML response so errors are visible
                                tabContent.innerHTML = html;
                            }
                        })
                        .catch(function() {
                            tabContent.innerHTML = '<div class="tab-content-inner"><h2>Add Airport</h2><p>Form could not be loaded.</p></div>';
                        });
                } else {
                    tabContent.innerHTML = '<div class="tab-content-inner"><h2>' + tabName + '</h2><p>Content for ' + tabName + '.</p></div>';
                }
            }
        }

        // Global function to close only the current tab
        window.closeCurrentTab = function() {
          if (!currentWorkspace) return;
          var ws = workspaces[currentWorkspace];
          var tabName = ws.activeTab;
          if (tabName && ws.openTabs[tabName]) {
            var tab = ws.openTabs[tabName];
            tabBar.removeChild(tab);
            delete ws.openTabs[tabName];
            var tabKeys = Object.keys(ws.openTabs);
            if (tabKeys.length > 0) {
              setActiveTab(tabKeys[tabKeys.length - 1]);
            } else {
              ws.activeTab = null;
              tabContent.innerHTML = '<h1>Welcome to the Financial Simulator</h1><p>This is your home page. The UI uses a dark, cold color palette inspired by VS Code.</p>';
            }
          }
        };

        function switchWorkspace(label) {
            // If workspace doesn't exist, create it
            if (!workspaces[label]) {
                workspaces[label] = { openTabs: {}, activeTab: null };
            }
            currentWorkspace = label;

            // Ensure each icon/workspace has a non-closable "Home" tab
            var ws = workspaces[label];
            if (!ws.openTabs[label]) {
                createTab(label, { nonClosable: true });
                ws.activeTab = label;
            }

            // Clear tab bar and re-attach this workspace's tabs
            while (tabBar.firstChild) tabBar.removeChild(tabBar.firstChild);
            Object.entries(ws.openTabs).forEach(function([tabName, tab]) {
                tabBar.appendChild(tab);
            });

            // Set active tab
            if (ws.activeTab && ws.openTabs[ws.activeTab]) {
                setActiveTab(ws.activeTab);
            } else {
                setActiveTab(label);
            }
        }
    });
    </script>
</body>
</html>
