{% load humanize %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Fresh-24 Financial Simulator</title>
    <link rel="stylesheet" href="/static/style.css?v=3">
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    <script src="/static/js/sidebar.js"></script>
    <script src="/static/js/app-core.js"></script>
    <script src="/static/js/routes-tab.js"></script>
    <script src="/static/js/checkbox-handlers.js"></script>
    <script src="/static/js/progress-modal.js"></script>
</head>
<body>
    <nav class="navbar">
        <span class="navbar-title">Fresh-24 Financial Simulator</span>
        <div class="navbar-links">
            <a href="/">Home</a>
            <a href="/login/">Login</a>
        </div>
    </nav>
    <div class="layout">
        <aside class="sidebar">
            <a href="#" class="sidebar-icon" data-label="Administrator">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#f7c97e" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <circle cx="12" cy="8" r="4"/>
                    <path d="M4 20c0-4 8-4 8-4s8 0 8 4"/>
                    <rect x="9" y="16" width="6" height="4" rx="1" fill="#f7c97e" stroke="#f7c97e"/>
                </svg>
                <span class="tooltip">Administrator</span>
            </a>
            <a href="#" class="sidebar-icon" data-label="User">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#7ec3f7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="8" r="4"/><path d="M4 20c0-4 8-4 8-4s8 0 8 4"/></svg>
                <span class="tooltip">User</span>
            </a>
            <a href="#" class="sidebar-icon" data-label="Shipment">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#7ec3f7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="7" width="18" height="13" rx="2"/><path d="M16 3v4M8 3v4"/><path d="M3 10h18"/></svg>
                <span class="tooltip">Shipment</span>
            </a>
            <a href="#" class="sidebar-icon" data-label="Scheduling">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#7ec3f7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="4" width="18" height="18" rx="2"/><path d="M16 2v4M8 2v4"/><path d="M3 10h18"/></svg>
                <span class="tooltip">Scheduling</span>
            </a>
            <a href="#" class="sidebar-icon" data-label="Simulation">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#7ec3f7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><polygon points="5 3 19 12 5 21 5 3"/></svg>
                <span class="tooltip">Simulation</span>
            </a>
            <a href="#" class="sidebar-icon" data-label="Settings">
                <svg width="28" height="28" viewBox="0 0 24 24" fill="none" stroke="#7ec3f7" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><circle cx="12" cy="12" r="3"/><path d="M19.4 15a1.65 1.65 0 0 0 .33 1.82l.06.06a2 2 0 0 1-2.83 2.83l-.06-.06a1.65 1.65 0 0 0-1.82-.33 1.65 1.65 0 0 0-1 1.51V21a2 2 0 0 1-4 0v-.09a1.65 1.65 0 0 0-1-1.51 1.65 1.65 0 0 0-1.82.33l-.06.06a2 2 0 0 1-2.83-2.83l.06-.06a1.65 1.65 0 0 0 .33-1.82 1.65 1.65 0 0 0-1.51-1H3a2 2 0 0 1 0-4h.09a1.65 1.65 0 0 0 1.51-1 1.65 1.65 0 0 0-.33-1.82l-.06-.06a2 2 0 0 1 2.83-2.83l.06.06a1.65 1.65 0 0 0 1.82.33h.09a1.65 1.65 0 0 0 1-1.51V3a2 2 0 0 1 4 0v.09a1.65 1.65 0 0 0 1 1.51h.09a1.65 1.65 0 0 0 1.82-.33l.06-.06a2 2 0 0 1 2.83 2.83l-.06.06a1.65 1.65 0 0 0-.33 1.82v.09a1.65 1.65 0 0 0 1.51 1H21a2 2 0 0 1 0 4h-.09a1.65 1.65 0 0 0-1.51 1z"/></svg>
                <span class="tooltip">Settings</span>
            </a>
        </aside>
        <aside id="options-sidebar" class="options-sidebar">
            <div id="options-sidebar-content">Select an option</div>
                <div id="user-menu" style="display:none">
                    <div class="vscode-tree">
                        <div class="vscode-tree-item" data-toggle="manage-branch">
                            <span class="vscode-tree-arrow">&gt;</span> Manage Regions
                        </div>
                        <div class="vscode-tree-children" data-parent="manage-branch" style="display:none;">
                            <div><a href="#" class="user-option menu-option">Region Core Data</a></div>
                            <div><a href="#" class="user-option menu-option">Branch Information</a></div>
                        </div>
                        <div class="vscode-tree-item" data-toggle="manage-products">
                            <span class="vscode-tree-arrow">&gt;</span> Manage Products
                        </div>
                        <div class="vscode-tree-children" data-parent="manage-products" style="display:none;">
                            <div><a href="#" class="user-option menu-option">Add Products</a></div>
                            <div><a href="#" class="user-option menu-option">View Products</a></div>
                        </div>
                    </div>
                </div>
                <div id="admin-menu" style="display:none">
                    <div class="vscode-tree">
                        <div class="vscode-tree-item" data-toggle="logistics">
                            <span class="vscode-tree-arrow">&gt;</span> Logistics
                        </div>
                        <div class="vscode-tree-children" data-parent="logistics" style="display:none;">
                            <div class="vscode-tree-item" data-toggle="air">
                                <span class="vscode-tree-arrow">&gt;</span> Air
                            </div>
                            <div class="vscode-tree-children" data-parent="air" style="display:none;">
                                <div><a href="#" class="admin-option menu-option">Mode</a></div>
                                <div><a href="#" class="admin-option menu-option">Airports</a></div>
                                <div><a href="#" class="admin-option menu-option">Aircraft</a></div>
                                <div><a href="#" class="admin-option menu-option">Routes</a></div>
                            </div>
                            <div class="vscode-tree-item">Land</div>
                            <div class="vscode-tree-item">Sea</div>
                        </div>
                        <div class="vscode-tree-item" data-toggle="user-management">
                            <span class="vscode-tree-arrow">&gt;</span> User Management
                        </div>
                        <div class="vscode-tree-children" data-parent="user-management" style="display:none;">
                            <div><a href="#" class="admin-option menu-option">User Management</a></div>
                        </div>
                        <div class="vscode-tree-item" data-toggle="supplychain">
                            <span class="vscode-tree-arrow">&gt;</span> Supply Chain
                        </div>
                        <div class="vscode-tree-children" data-parent="supplychain" style="display:none;"></div>
                    </div>
                </div>
        </aside>
        <main class="main-content">
            <div id="tab-bar" class="tab-bar"></div>
            <div id="tab-content">
                <div id="tab-content-inner" class="tab-content-inner aircraft-tab">
                    <h1>Welcome to the Financial Simulator</h1>
                    <p>This is your home page. The UI uses a dark, cold color palette inspired by VS Code.</p>
                </div>
            </div>
        </main>
        <!-- Hidden server-side rendered lists -->
        <div id="aircraft-list-container" style="display:none;">
            <div class="tab-content-inner aircraft-tab">
                <h2>Aircraft</h2>
                <section class="aircraft-list-section">
                    {% include 'aircraft_list_table.html' %}
                </section>
                <section class="aircraft-actions" style="display:flex;gap:0.75rem;margin-top:1rem;">
                    <button id="add-aircraft-btn" class="primary-button">Add New Aircraft</button>
                    <button id="edit-aircraft-btn" class="primary-button">Edit Selected</button>
                    <button id="delete-aircraft-btn" class="danger-button" disabled>Delete Selected</button>
                </section>
            </div>
        </div>
        <div id="airport-list-container" style="display:none;">
            <div class="tab-content-inner airports-tab">
                <h2>Airports</h2>
                <section class="airports-list-section">
                    {% include 'airport_list_table.html' %}
                </section>
                <section class="airports-actions" style="display:flex;gap:0.75rem;margin-top:1rem;">
                    <button id="add-airport-btn" class="primary-button">Add New Airport</button>
                    <button id="edit-airport-btn-airport" class="primary-button">Edit Selected</button>
                    <button id="delete-airport-btn-airport" class="danger-button" disabled>Delete Selected</button>
                </section>
            </div>
        </div>
        </aside>
        <!-- Side menu removed for minimal layout -->
        <!-- main-content now inside <main> above -->
    </div>
    <!-- Hidden template with the Add Aircraft form markup -->
    <template id="add-aircraft-fragment">
        {% include 'add_aircraft.html' %}
    </template>
    <!-- Hidden template with the Add Airport form markup -->
    <template id="add-airport-fragment">
        {% include 'add_airport.html' %}
    </template>
    <footer class="footer">
        <style>
        .vscode-tree-item.open > .vscode-tree-arrow {
            transform: rotate(90deg) scaleY(1.2);
            display: inline-block;
            transition: transform 0.1s;
        }
        /* Indent VS Code-style tree items and options (default for all menus) */
        .vscode-tree-children {
            padding-left: 2ch; /* keep groups a bit indented */
        }
        .menu-option {
            padding-left: 1ch; /* leaf options ~1 character indent */
            font-size: 0.9rem;  /* slightly smaller font for final options */
            color: var(--vscode-fg, #d4d4d4) !important; /* keep same high-contrast color */
            text-decoration: none;
            display: block;
        }
        /* Remove bullets and extra padding from user menu lists */
        #user-menu ul {
            list-style: none;
            margin: 0;
            padding-left: 0;
        }
        </style>
        <div>Powered by Dnamic aircraft Services</div>
        <div><a href="https://www.dnamic-tech.com" target="_blank" rel="noopener">www.dnamic-tech.com</a></div>
    </footer>

    <!-- Progress Modal -->
    <div id="progress-modal" class="progress-modal-overlay" style="display:none;">
      <div class="progress-modal-box">
        <div class="progress-modal-spinner"></div>
        <div id="progress-modal-title" class="progress-modal-title">Saving...</div>
        <div id="progress-modal-message" class="progress-modal-message">Please wait while the system updates.</div>
      </div>
    </div>
    <style>
      .progress-modal-overlay {
        position: fixed;
        top: 0; left: 0; right: 0; bottom: 0;
        background: rgba(0,0,0,0.7);
        z-index: 9999;
        display: flex;
        align-items: center;
        justify-content: center;
      }
      .progress-modal-box {
        background: #23272e;
        border-radius: 12px;
        padding: 2.5rem 3rem;
        box-shadow: 0 8px 32px rgba(0,0,0,0.5);
        text-align: center;
        min-width: 320px;
      }
      .progress-modal-spinner {
        border: 4px solid #444;
        border-top: 4px solid #4fc3f7;
        border-radius: 50%;
        width: 48px;
        height: 48px;
        animation: spin 1s linear infinite;
        margin: 0 auto 1.5rem auto;
      }
      @keyframes spin {
        0% { transform: rotate(0deg); }
        100% { transform: rotate(360deg); }
      }
      .progress-modal-title {
        font-size: 1.25rem;
        font-weight: 600;
        color: #e0e0e0;
        margin-bottom: 0.5rem;
      }
      .progress-modal-message {
        font-size: 1rem;
        color: #b0b0b0;
      }
    </style>
    <script>
    // Global progress modal helpers
    window.showProgressModal = function(title, message) {
      document.getElementById('progress-modal-title').textContent = title || 'Saving...';
      document.getElementById('progress-modal-message').textContent = message || 'Please wait while the system updates.';
      document.getElementById('progress-modal').style.display = 'flex';
    };
    window.hideProgressModal = function() {
      document.getElementById('progress-modal').style.display = 'none';
    };
    </script>
</body>
</html>
