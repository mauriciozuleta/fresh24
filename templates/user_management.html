{% load static %}
<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Commercial Structure Management</title>
    <link rel="stylesheet" href="{% static 'style.css' %}">
</head>
<body>
    <h1>Commercial Structure Management</h1>
    <div id="form-container" style="background:#23272e; padding:2rem; border-radius:10px; margin-bottom:2rem;">
        <div class="aircraft-form-row" style="gap: 2rem;">
            <div class="form-group">
                <label for="region-select">Select Region:</label>
                <select id="region-select" class="aircraft-form-control">
                    <option value="">Loading regions...</option>
                </select>
            </div>
            <div class="form-group">
                <label for="regional-manager">Regional Manager</label>
                <input type="text" id="regional-manager" class="aircraft-form-control" placeholder="Enter manager name">
            </div>
            <div class="form-group">
                <label for="region-user">Region User</label>
                <input type="text" id="region-user" class="aircraft-form-control" placeholder="Enter user name">
            </div>
            <div style="display: flex; align-items: flex-end; margin-left: 3rem;">
                <button id="edit-region-btn" class="primary-button" type="button" style="white-space: nowrap;">Edit Region</button>
            </div>
        </div>
        <div class="aircraft-form-row" style="gap: 2rem; margin-top: 1.5rem;">
            <div class="form-group" id="countries-group">
                <label for="country-select">Countries:</label>
                <select id="country-select" class="aircraft-form-control" disabled>
                    <option value="">Select a region first</option>
                </select>
            </div>
            <div class="form-group">
                <label for="country-manager">Country Manager</label>
                <input type="text" id="country-manager" class="aircraft-form-control" placeholder="Enter country manager name">
            </div>
            <div class="form-group">
                <label for="country-user">Country User</label>
                <input type="text" id="country-user" class="aircraft-form-control" placeholder="Enter country user name">
            </div>
            <div style="display: flex; align-items: flex-end; margin-left: 3rem;">
                <button id="add-country-btn" class="primary-button" type="button" style="white-space: nowrap;">Add Country</button>
            </div>
        </div>
        <div class="aircraft-form-row" style="gap: 2rem; margin-top: 1.5rem;">
            <div class="form-group" id="airports-group">
                <label for="airport-select">Airports:</label>
                <select id="airport-select" class="aircraft-form-control" disabled>
                    <option value="">Select a country first</option>
                </select>
            </div>
            <div class="form-group">
                <label for="branch-manager">Branch Manager</label>
                <input type="text" id="branch-manager" class="aircraft-form-control" placeholder="Enter branch manager name">
            </div>
            <div class="form-group">
                <label for="branch-user">Branch User</label>
                <input type="text" id="branch-user" class="aircraft-form-control" placeholder="Enter branch user name">
            </div>
            <div style="display: flex; align-items: flex-end; margin-left: 3rem;">
                <button id="add-branch-btn" class="primary-button" type="button" style="white-space: nowrap;">Add Branch</button>
            </div>
        </div>
    </div>
    <div id="table-container" style="width:100%; display:flex; justify-content:center; align-items:center; margin:2rem 0;">
        <div id="table-placeholder" style="width:90%; min-height:60px; background:#222; color:#fff; border:2px dashed #0078d4; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:1.2rem; margin:2rem auto; text-align:center;">
            <span>TABLE PLACEHOLDER — Table will be built here. If you see this, the divider is working. (Bug tracking)</span>
        </div>
    </div>
    <div style="width:100%; display:flex; justify-content:center; align-items:center; margin:2rem 0;">
        <div id="table-placeholder" style="width:90%; min-height:60px; background:#222; color:#fff; border:2px dashed #0078d4; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:1.2rem; margin:2rem auto; text-align:center;">
            <span>TABLE PLACEHOLDER — Table will be built here. If you see this, the divider is working. (Bug tracking)</span>
        </div>
    </div>
    <div id="region-list">
        <!-- Region list will be rendered here -->
    </div>
<script>
// Populate regions, countries, and airports dropdowns
document.addEventListener('DOMContentLoaded', function() {
    const regionSelect = document.getElementById('region-select');
    const countrySelect = document.getElementById('country-select');
    const airportSelect = document.getElementById('airport-select');
    const countriesGroup = document.getElementById('countries-group');
    const airportsGroup = document.getElementById('airports-group');
    
    // Fetch and populate regions
    fetch('/api/regions/')
        .then(r => r.json())
        .then(data => {
            if (data.regions && data.regions.length > 0) {
                regionSelect.innerHTML = '<option value="">Select a region</option>' +
                    data.regions.map(region => `<option value="${region}">${region}</option>`).join('');
                regionSelect.disabled = false;
            } else {
                regionSelect.innerHTML = '<option value="">No regions found</option>';
                regionSelect.disabled = true;
            }
        })
        .catch(err => console.error('Error fetching regions:', err));
    
    // Populate countries when region changes
    regionSelect.addEventListener('change', function() {
        const region = regionSelect.value;
        
        // Reset country and airport dropdowns
        countrySelect.innerHTML = '<option value="">Select a region first</option>';
        countrySelect.disabled = true;
        airportSelect.innerHTML = '<option value="">Select a country first</option>';
        airportSelect.disabled = true;
        
        if (!region) {
            return;
        }
        
        fetch(`/api/countries-by-region/?region=${encodeURIComponent(region)}`)
            .then(r => r.json())
            .then(data => {
                console.log('Countries data:', data);
                if (data.countries && data.countries.length > 0) {
                    countrySelect.innerHTML = data.countries.map(c => `<option value="${c.code}">${c.name}</option>`).join('');
                    countrySelect.disabled = false;
                    if (countriesGroup) {
                        countriesGroup.style.display = 'block';
                    }
                } else {
                    countrySelect.innerHTML = '<option value="">No countries found</option>';
                    countrySelect.disabled = true;
                }
            })
            .catch(err => console.error('Error fetching countries:', err));
    });
    
    // Populate airports when country changes
    countrySelect.addEventListener('change', function() {
        const country = countrySelect.value;
        console.log('Country selected:', country);
        
        // Reset airport dropdown
        airportSelect.innerHTML = '<option value="">Select a country first</option>';
        airportSelect.disabled = true;
        
        if (!country) {
            return;
        }
        
        fetch('/api/airports-by-country/?country=' + encodeURIComponent(country))
            .then(r => r.json())
            .then(data => {
                console.log('Airports data:', data);
                const airports = data.airports || [];
                if (airports.length > 0) {
                    airportSelect.innerHTML = airports.map(a => `<option value="${a.iata_code}">${a.iata_code} - ${a.city}</option>`).join('');
                    airportSelect.disabled = false;
                    if (airportsGroup) {
                        airportsGroup.style.display = 'block';
                    }
                } else {
                    airportSelect.innerHTML = '<option value="">No airports found</option>';
                    airportSelect.disabled = true;
                }
            })
            .catch(err => {
                console.error('Error fetching airports:', err);
                airportSelect.innerHTML = '<option value="">Error loading airports</option>';
                airportSelect.disabled = true;
            });
    });
});
</script>
</body>
</html>
